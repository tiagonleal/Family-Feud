<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Feud - Conversor de Excel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(180deg, #0a0f2c 0%, #1a237e 50%, #0d1b4c 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 30px;
        }
        
        .steps {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .step {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
        }
        
        .step h2 {
            color: #ffd700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: #ffd700;
            color: #0a0f2c;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 10px;
            background: #1a1a2e;
            color: white;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #ffd700;
        }
        
        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }
        
        .btn-primary {
            background: linear-gradient(180deg, #ffd700, #ffaa00);
            color: #0a0f2c;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255,215,0,0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(180deg, #4a90d9, #2e5a8a);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: scale(1.05);
        }
        
        .btn-success {
            background: linear-gradient(180deg, #43a047, #2e7d32);
            color: white;
        }
        
        .btn-success:hover {
            transform: scale(1.05);
        }
        
        .info {
            background: rgba(74, 144, 217, 0.2);
            border-left: 4px solid #4a90d9;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .info p {
            margin: 5px 0;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.2);
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .preview {
            background: #0d1b4c;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .preview-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #ffd700;
        }
        
        .preview-item .question {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .preview-item .answers {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .back-link {
            display: inline-block;
            color: #ffd700;
            text-decoration: none;
            margin-bottom: 20px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .count {
            background: #ffd700;
            color: #0a0f2c;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
        }
        
        #aiPrompt {
            height: 400px;
        }
        
        .copy-hint {
            color: #4ecdc4;
            font-size: 0.9rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Voltar ao Menu</a>
        
        <h1>üìä Conversor de Excel</h1>
        <p class="subtitle">Importa perguntas do Excel e traduz para Portugu√™s de Portugal</p>
        
        <div class="steps">
            <!-- PASSO 1 -->
            <div class="step">
                <h2><span class="step-number">1</span> Colar Excel</h2>
                
                <div class="info">
                    <p>üìã Abre o Excel, seleciona todas as linhas e colunas, e cola aqui (Ctrl+V)</p>
                    <p>Formato: Pergunta | Resp1 | Pts1 | Resp2 | Pts2 | ... (7 respostas)</p>
                </div>
                
                <textarea id="excelInput" placeholder="Cola aqui os dados do Excel...
Exemplo:
Tell Me The Age When Boys Stop Playing With Stuffed Animals	7	22	8	19	10	15	5	11	6	10	4	9	3	8"></textarea>
                
                <button class="btn-primary" onclick="processExcel()">
                    üîÑ Processar Excel
                </button>
                
                <div id="previewArea" style="display:none;">
                    <div class="count" id="questionCount">0 perguntas encontradas</div>
                    <div class="preview" id="preview"></div>
                </div>
            </div>
            
            <!-- PASSO 2 -->
            <div class="step">
                <h2><span class="step-number">2</span> Traduzir com AI</h2>
                
                <div class="warning">
                    <p>ü§ñ Copia o texto abaixo e cola no <strong>ChatGPT</strong>, <strong>Claude</strong> ou outro AI</p>
                    <p>Depois cola a resposta do AI no Passo 3</p>
                </div>
                
                <textarea id="aiPrompt" readonly placeholder="Primeiro processa o Excel no Passo 1..."></textarea>
                
                <button class="btn-secondary" onclick="copyPrompt()">
                    üìã Copiar Prompt
                </button>
                <p class="copy-hint">Depois de copiar, cola no ChatGPT e pede para traduzir</p>
            </div>
            
            <!-- PASSO 3 -->
            <div class="step">
                <h2><span class="step-number">3</span> Importar Tradu√ß√£o</h2>
                
                <div class="info">
                    <p>üì• Cola aqui a resposta do AI (JSON traduzido)</p>
                </div>
                
                <textarea id="translatedInput" placeholder="Cola aqui o JSON traduzido pelo AI..."></textarea>
                
                <button class="btn-success" onclick="importTranslated()">
                    ‚úÖ Importar para o Jogo
                </button>
                
                <div id="importResult" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script>
        let parsedQuestions = [];
        
        function processExcel() {
            const input = document.getElementById('excelInput').value.trim();
            if (!input) {
                alert('Cola os dados do Excel primeiro!');
                return;
            }
            
            const lines = input.split('\n').filter(line => line.trim());
            parsedQuestions = [];
            
            lines.forEach((line, lineIndex) => {
                // Separar por tab (Excel) ou m√∫ltiplos espa√ßos
                const parts = line.split(/\t/).map(p => p.trim()).filter(p => p);
                
                if (parts.length < 3) return; // Precisa de pelo menos pergunta + 1 resposta + 1 pontua√ß√£o
                
                const question = parts[0];
                const answers = [];
                
                // Processar pares resposta/pontos
                for (let i = 1; i < parts.length - 1; i += 2) {
                    const answerText = parts[i];
                    const points = parseInt(parts[i + 1]) || 0;
                    
                    if (answerText && !isNaN(points)) {
                        answers.push({
                            text: answerText,
                            points: points
                        });
                    }
                }
                
                if (answers.length > 0) {
                    parsedQuestions.push({
                        text: question,
                        answers: answers
                    });
                }
            });
            
            // Mostrar preview
            const previewArea = document.getElementById('previewArea');
            const preview = document.getElementById('preview');
            const count = document.getElementById('questionCount');
            
            count.textContent = `${parsedQuestions.length} perguntas encontradas`;
            
            // Fun√ß√£o para escapar HTML
            const escapeHtml = (text) => {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            };
            
            preview.innerHTML = parsedQuestions.slice(0, 5).map((q, i) => `
                <div class="preview-item">
                    <div class="question">${i + 1}. ${escapeHtml(q.text)}</div>
                    <div class="answers">${q.answers.map(a => `${escapeHtml(a.text)} (${a.points}pts)`).join(' | ')}</div>
                </div>
            `).join('') + (parsedQuestions.length > 5 ? `<p style="color:#888; text-align:center;">... e mais ${parsedQuestions.length - 5} perguntas</p>` : '');
            
            previewArea.style.display = 'block';
            
            // Gerar prompt para AI
            generateAIPrompt();
        }
        
        function generateAIPrompt() {
            const prompt = `Traduz as seguintes perguntas e respostas do Family Feud para Portugu√™s de Portugal (PT-PT).

REGRAS IMPORTANTES:
1. Usa portugu√™s de PORTUGAL (n√£o brasileiro)
2. Mant√©m as respostas curtas e naturais
3. Adapta express√µes culturais se necess√°rio
4. Mant√©m a estrutura JSON exactamente igual
5. N√ÉO traduzas os n√∫meros dos pontos
6. Responde APENAS com o JSON, sem explica√ß√µes

JSON para traduzir:
${JSON.stringify(parsedQuestions, null, 2)}

Responde com o JSON traduzido:`;
            
            document.getElementById('aiPrompt').value = prompt;
        }
        
        function copyPrompt() {
            const prompt = document.getElementById('aiPrompt');
            prompt.select();
            document.execCommand('copy');
            
            alert('‚úÖ Prompt copiado!\n\nAgora cola no ChatGPT ou Claude e pede para traduzir.');
        }
        
        function importTranslated() {
            const input = document.getElementById('translatedInput').value.trim();
            const resultDiv = document.getElementById('importResult');
            
            if (!input) {
                resultDiv.innerHTML = '<p style="color: #ff6b6b;">‚ùå Cola o JSON traduzido primeiro!</p>';
                return;
            }
            
            try {
                // Tentar extrair JSON do texto (caso o AI adicione texto extra)
                let jsonStr = input;
                
                // Se cont√©m ``` (markdown code block), extrair
                const codeBlockMatch = input.match(/```(?:json)?\s*([\s\S]*?)\s*```/);
                if (codeBlockMatch) {
                    jsonStr = codeBlockMatch[1];
                }
                
                // Tentar encontrar array JSON
                const arrayMatch = jsonStr.match(/\[[\s\S]*\]/);
                if (arrayMatch) {
                    jsonStr = arrayMatch[0];
                }
                
                const translated = JSON.parse(jsonStr);
                
                if (!Array.isArray(translated)) {
                    throw new Error('O JSON deve ser um array de perguntas');
                }
                
                // Validar estrutura
                const validQuestions = translated.filter(q => {
                    return q.text && q.answers && Array.isArray(q.answers) && q.answers.length > 0;
                });
                
                if (validQuestions.length === 0) {
                    throw new Error('Nenhuma pergunta v√°lida encontrada');
                }
                
                // Adicionar campos necess√°rios
                const questionsToAdd = validQuestions.map((q, i) => ({
                    id: Date.now() + i,
                    text: q.text,
                    answers: q.answers.map(a => ({
                        text: a.text || '',
                        points: parseInt(a.points) || 0
                    })),
                    createdAt: new Date().toISOString()
                }));
                
                // Carregar perguntas existentes
                const existing = Storage.getQuestions();
                
                // Adicionar novas
                const allQuestions = [...existing, ...questionsToAdd];
                
                // Guardar
                Storage.saveQuestions(allQuestions);
                
                resultDiv.innerHTML = `
                    <div style="background: rgba(67, 160, 71, 0.2); border: 2px solid #43a047; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #4ecdc4; margin-bottom: 10px;">‚úÖ Importa√ß√£o Conclu√≠da!</h3>
                        <p style="font-size: 1.5rem; margin: 10px 0;">${questionsToAdd.length} perguntas adicionadas</p>
                        <p style="color: #888;">Total no jogo: ${allQuestions.length} perguntas</p>
                        <button onclick="window.location.href='editor.html'" class="btn-primary" style="margin-top: 15px;">
                            ‚úèÔ∏è Ver no Editor
                        </button>
                    </div>
                `;
                
            } catch (e) {
                resultDiv.innerHTML = `
                    <div style="background: rgba(229, 57, 53, 0.2); border: 2px solid #e53935; padding: 15px; border-radius: 10px;">
                        <p style="color: #ff6b6b;">‚ùå Erro ao processar JSON:</p>
                        <p style="color: #aaa; font-size: 0.9rem;">${e.message}</p>
                        <p style="color: #888; margin-top: 10px;">Certifica-te que o AI respondeu com JSON v√°lido.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
